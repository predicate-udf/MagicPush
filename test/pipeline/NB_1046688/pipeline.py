import sys
sys.path.append("/datadrive/yin/predicate_pushdown_for_lineage_tracking/")
from interface import *

billboard_raw_df = InitTable('billboard.pickle')

billboard_melted_df = UnPivot(billboard_raw_df, \
    ['year', 'artist.inverted', 'track', 'time', 'genre', 'date.entered', 'date.peaked'],\
    ['x1st.week', 'x2nd.week', 'x3rd.week', 'x4th.week',\
       'x5th.week', 'x6th.week', 'x7th.week', 'x8th.week', 'x9th.week',\
       'x10th.week', 'x11th.week', 'x12th.week', 'x13th.week', 'x14th.week',\
       'x15th.week', 'x16th.week', 'x17th.week', 'x18th.week', 'x19th.week',\
       'x20th.week', 'x21st.week', 'x22nd.week', 'x23rd.week', 'x24th.week',\
       'x25th.week', 'x26th.week', 'x27th.week', 'x28th.week', 'x29th.week',\
       'x30th.week', 'x31st.week', 'x32nd.week', 'x33rd.week', 'x34th.week',\
       'x35th.week', 'x36th.week', 'x37th.week', 'x38th.week', 'x39th.week',\
       'x40th.week', 'x41st.week', 'x42nd.week', 'x43rd.week', 'x44th.week',\
       'x45th.week', 'x46th.week', 'x47th.week', 'x48th.week', 'x49th.week',\
       'x50th.week', 'x51st.week', 'x52nd.week', 'x53rd.week', 'x54th.week',\
       'x55th.week', 'x56th.week', 'x57th.week', 'x58th.week', 'x59th.week',\
       'x60th.week', 'x61st.week', 'x62nd.week', 'x63rd.week', 'x64th.week',\
       'x65th.week', 'x66th.week', 'x67th.week', 'x68th.week', 'x69th.week',\
       'x70th.week', 'x71st.week', 'x72nd.week', 'x73rd.week', 'x74th.week',\
       'x75th.week', 'x76th.week'])

non_top_tracks = ['What You Want', 'Girls Dem Sugar', 'A Little Gasoline', 'Best Of Intentions', 'Where I Wanna Be', 'Flowers On The Wall', "It's So Hard", 'Rhythm Divine', 'Got Beef', 'Give Me You', 'Take That', 'I Learned From The Best', 'Without You', 'Caught Out There', "That's The Kind Of Mood I'm In", "U Don't Love Me", "Baby Don't Cry (Keep Ya Head Up II)", "That's What I'm Looking For", 'What Do You Say', 'One Night Stand', 'All The Small Things', 'The Chain Of Love', 'Re-Arranged', 'Stay The Night', 'Mr. Too Damn Good', "Let's Make Love", "Rollin'", 'Hey Papi', 'The Little Girl', 'Be With You', 'Unconditional', "You Won't Be Lonely Now", "Feelin' Good", 'More', 'Got To Get It', 'Some Things Never Change', 'Shake Your Bon-Bon', 'Cold Day In July', 'Shackles (Praise You)', 'Desert Rose', 'I Disappear', 'A Country Boy Can Survive', 'Crash And Burn', 'I Just Wanna Love U (Give It 2 Me)', 'Thank God I Found You', "Don't Think I'm Not", 'A Puro Dolor (Purest Of Pain)', "Toca's Miracle", 'Lucky', "I'm Outta Love", "Can't Fight The Moonlight", 'Anything', 'Back At One', "I'll Be", 'Dance Tonight', 'Come On Over Baby (All I Want Is You)', 'Swear It Again', 'Shake Ya Ass', "Love's The Only House", '911', 'Pinch Me', 'Wonderful', 'Ryde or Die, Chick', 'Just Friends (Sunny)', "You Should've Told Me", 'What I Need To Do', 'Nothing As It Seems', 'Broadway', 'Summer Rain', "Doesn't Really Matter", "I Think I'm In Love With You", 'Deep Inside', 'Kiss This', 'Big Deal', 'Got It All', 'This Woman Needs', 'The Best Of Me', 'Live, Laugh, Love', 'Better Off Alone', 'Meanwhile Back At The Ranch', 'Because You Love Me', 'Love Is Blind', 'Change Your Mind', 'Pop Ya Collar', 'Shut Up', 'Bad Boyz', 'Cowboy Take Me Away', 'None Of Ur Friends Business', 'Mirror Mirror', 'Put Your Hand In Mine', "Freakin' It", 'Still In My Heart', 'Just Be A Man About It', 'Separated', 'Spanish Guitar', "Can't Stay", 'Falls Apart', 'Music', 'It Feels So Good', 'The One', 'This I Promise You', 'No Matter What They Say', 'Baby U Are', 'Bye Bye Bye', "Don't Call Me Baby", 'Been There', 'The Rockafeller Skank', 'Feels Like Love', "Don't Say You Love Me", "The Quittin' Kind", 'The Way I Am', 'American Pie', 'The Next Episode', 'Best Friend', 'Hot Boyz', 'I Think God Can Explain', 'Love Sets You Free', 'We Danced', 'Bounce With Me', 'As We Lay', 'Shape Of My Heart', 'Pop A Top', 'Dancing Queen', 'I Know', 'Whistle While You Twurk', 'Who Let The Dogs Out', 'Lessons Learned', 'One Voice', "Big Pimpin'", 'Monica', "You'll Always Be Loved By Me", 'Get Up', 'Do It Again (Put Ya Hands Up)', 'Where You Are', 'The Great Beyond', "It's Always Somethin'", 'N 2 Gether Now', 'Ta Da', 'Californication', 'Stan', 'What Means The World To You', 'Buy Me A Rose', 'Could I Have This Kiss Forever', 'Whoa!', "It's My Life", 'All Good?', 'Then The Morning Comes', "Dancin'", 'Open My Heart', "Daddy Won't Sell The Farm", 'You Owe Me', 'If I Am', 'West Side Story', 'Yes!', 'When You Need My Love', 'Private Emotion', "What'Chu Like", 'Another Dumb Blonde', 'Gotta Tell You', 'Never Let You Go', 'Smile', 'Breathe And Stop', 'Tha Block Is Hot', 'Country Comes To Town', "What's Your Fantasy", 'Whatever', "I Don't Wanna", 'L.A. Song', "You're A God", 'Incomplete', "G'D Up", 'Another Nine Minutes', 'My Best Friend', "Prayin' For Daylight", '3 Little Words', 'www.memory', 'It Must Be Love', 'Original Prankster', 'No Leaf Clover (Live)', 'I Turn To You', 'U Understand', 'It Was', 'What A Girl Wants', 'Party Up (Up In Here)', 'Forgot About Dre', 'I Will.. But', 'My Love Goes On And On', 'Angels', 'Me Neither', 'Left, Right, Left', 'The Itch', 'Give Me Just One Night (Una Noche)', 'Treat Her Like A Lady', 'Sour Girl', 'No More Rain (In This Cloud)', 'I Will Love Again', 'The Best Day', 'Left & Right', 'I Belong To You', 'How Do You Like Me Now?!', 'There You Are', "What's My Name", 'Tricky Tricky ', "Can't Go For That", 'Emotional', 'Wobble Wobble', 'Loser', 'Otherside', 'The Hardest Part Of Breaking Up (Is Getting Back Your Stuff)', 'Pull Over', 'No Mercy', 'I Lost It', 'Only God Knows Why', 'Simple Kind Of Life', 'Oops!.. I Did It Again', 'My Baby You', 'Someday Out Of The Blue', "He Can't Love U", 'No More', "She's More", 'From The Bottom Of My Broken Heart', 'I Like It', 'Imagine That', 'Take A Picture', 'Souljas', 'Untitled (How Does It Feel)', 'Blue (Da Ba Dee)', 'Deep Inside Of You', 'Liar', 'Bag Lady', 'Smoke Rings In The Dark', 'That Other Woman', 'Between Me And You', 'She Bangs', 'Carlene', 'What About Now', 'How Many Licks?', 'I Need A Hot Girl', 'Go On', 'Kernkraft 400', 'My First Love', "Aaron's Party (Come Get It)", 'No Me Dejes De Querer', 'This Time Around', 'The Real Slim Shady', 'Straight Up', 'Same Script, Different Cast', 'Show Me The Meaning Of Being Lonely', 'The Light', 'Real Live Woman', "Couldn't Last A Moment", 'Do You', 'Auld Lang Syne (The Millenium Mix)', 'Learn To Fly', 'Born To Fly', 'Sleepwalker', 'Last Resort', 'Dear Lie', "That's The Way", 'Maria, Maria', 'The Bad Touch', 'Goodbye Earl', 'Graduation (Friends Forever)', "Let's Get Married", 'Hanginaround', 'Deck The Halls', 'My Next Thirty Years', 'Cherchez LaGhost', "It's Gonna Be Me", 'Do What You Gotta Do', 'Taking You Home', 'Your Everything', 'I Wanna Be With You', "Callin' Me", "I Don't Wanna Kiss You Goodnight", 'The Best Man I Can Be', 'Crybaby', 'Faded', 'Stay Or Let It Go', 'Wifey', 'Just Another Day In Paradise', 'I Wish', "If You Don't Wanna Love Me", 'Riddle', 'I Need You', 'You Can Do It']

billboard_melted_df1 = Rename(billboard_melted_df, {'variable':'week','value':'rank'})
billboard_melted_df2 = SetItem(billboard_melted_df1, "week", "lambda x: re.search((r'x(\d+)'), str(x['week'])).group(1)")
billboard_melted_df3 = ChangeType(billboard_melted_df2, "datetime",'time','time')
billboard_melted_df4 = SetItem(billboard_melted_df3, "time", "lambda df: df['time'].hour*60 + df['time'].minute")
billboard_melted_df5 = SetItem(billboard_melted_df4, "week", "lambda x: int(x['week'])")
billboard_melted_df6 = Pivot(billboard_melted_df5, ['week'], 'track','rank', 'mean', {'(Hot S**t) Country Grammar': 'int', '3 Little Words': 'int', '911': 'int', 'A Country Boy Can Survive': 'int', 'A Little Gasoline': 'int', 'A Puro Dolor (Purest Of Pain)': 'int', "Aaron's Party (Come Get It)": 'int', 'Absolutely (Story Of A Girl)': 'int', 'All Good?': 'int', 'All The Small Things': 'int', 'Amazed': 'int', 'American Pie': 'int', 'Angels': 'int', 'Another Dumb Blonde': 'int', 'Another Nine Minutes': 'int', 'Anything': 'int', 'As We Lay': 'int', 'Auld Lang Syne (The Millenium Mix)': 'int', "Baby Don't Cry (Keep Ya Head Up II)": 'int', 'Baby U Are': 'int', 'Back At One': 'int', 'Back Here': 'int', 'Bad Boyz': 'int', 'Bag Lady': 'int', 'Be With You': 'int', 'Because You Love Me': 'int', 'Been There': 'int', 'Bent': 'int', 'Best Friend': 'int', 'Best Of Intentions': 'int', 'Better Off Alone': 'int', 'Between Me And You': 'int', 'Big Deal': 'int', "Big Pimpin'": 'int', 'Blue (Da Ba Dee)': 'int', 'Born To Fly': 'int', 'Bounce With Me': 'int', 'Breathe': 'int', 'Breathe And Stop': 'int', 'Bring It All To Me': 'int', 'Broadway': 'int', 'Buy Me A Rose': 'int', 'Bye Bye Bye': 'int', 'Californication': 'int', "Callin' Me": 'int', "Can't Fight The Moonlight": 'int', "Can't Go For That": 'int', "Can't Stay": 'int', 'Carlene': 'int', 'Case Of The Ex (Whatcha Gonna Do)': 'int', 'Caught Out There': 'int', 'Change Your Mind': 'int', 'Cherchez LaGhost': 'int', 'Cold Day In July': 'int', 'Come On Over Baby (All I Want Is You)': 'int', 'Could I Have This Kiss Forever': 'int', "Couldn't Last A Moment": 'int', 'Country Comes To Town': 'int', 'Cowboy Take Me Away': 'int', 'Crash And Burn': 'int', 'Crybaby': 'int', "Daddy Won't Sell The Farm": 'int', 'Dance Tonight': 'int', "Dancin'": 'int', 'Dancing Queen': 'int', 'Dear Lie': 'int', 'Deck The Halls': 'int', 'Deep Inside': 'int', 'Deep Inside Of You': 'int', 'Desert Rose': 'int', 'Do It Again (Put Ya Hands Up)': 'int', 'Do What You Gotta Do': 'int', 'Do You': 'int', "Doesn't Really Matter": 'int', "Don't Call Me Baby": 'int', "Don't Say You Love Me": 'int', "Don't Think I'm Not": 'int', 'Emotional': 'int', 'Everything You Want': 'int', 'Faded': 'int', 'Falls Apart': 'int', "Feelin' Good": 'int', 'Feels Like Love': 'int', 'Flowers On The Wall': 'int', 'Forgot About Dre': 'int', "Freakin' It": 'int', 'From The Bottom Of My Broken Heart': 'int', "G'D Up": 'int', 'Get It On.. Tonite': 'int', 'Get Up': 'int', 'Girls Dem Sugar': 'int', 'Give Me Just One Night (Una Noche)': 'int', 'Give Me You': 'int', 'Go On': 'int', 'Goodbye Earl': 'int', 'Got Beef': 'int', 'Got It All': 'int', 'Got To Get It': 'int', 'Gotta Tell You': 'int', 'Graduation (Friends Forever)': 'int', 'Hanginaround': 'int', "He Can't Love U": 'int', 'He Loves U Not': 'int', "He Wasn't Man Enough": 'int', 'Hey Papi': 'int', 'Higher': 'int', 'Hot Boyz': 'int', 'How Do You Like Me Now?!': 'int', 'How Many Licks?': 'int', 'I Belong To You': 'int', 'I Disappear': 'int', "I Don't Wanna": 'int', "I Don't Wanna Kiss You Goodnight": 'int', 'I Just Wanna Love U (Give It 2 Me)': 'int', 'I Knew I Loved You': 'int', 'I Know': 'int', 'I Learned From The Best': 'int', 'I Like It': 'int', 'I Lost It': 'int', 'I Need A Hot Girl': 'int', 'I Need You': 'int', 'I Think God Can Explain': 'int', "I Think I'm In Love With You": 'int', 'I Try': 'int', 'I Turn To You': 'int', 'I Wanna Be With You': 'int', 'I Wanna Know': 'int', 'I Will Love Again': 'int', 'I Will.. But': 'int', 'I Wish': 'int', "I'll Be": 'int', "I'm Outta Love": 'int', 'If I Am': 'int', "If You Don't Wanna Love Me": 'int', 'Imagine That': 'int', 'Incomplete': 'int', 'Independent Women Part I': 'int', 'It Feels So Good': 'int', 'It Must Be Love': 'int', 'It Was': 'int', "It's Always Somethin'": 'int', "It's Gonna Be Me": 'int', "It's My Life": 'int', "It's So Hard": 'int', "Jumpin' Jumpin'": 'int', 'Just Another Day In Paradise': 'int', 'Just Be A Man About It': 'int', 'Just Friends (Sunny)': 'int', 'Kernkraft 400': 'int', 'Kiss This': 'int', 'Kryptonite': 'int', 'L.A. Song': 'int', 'Last Resort': 'int', 'Learn To Fly': 'int', 'Left & Right': 'int', 'Left, Right, Left': 'int', 'Lessons Learned': 'int', "Let's Get Married": 'int', "Let's Make Love": 'int', 'Liar': 'int', 'Live, Laugh, Love': 'int', 'Loser': 'int', 'Love Is Blind': 'int', 'Love Sets You Free': 'int', "Love's The Only House": 'int', 'Lucky': 'int', 'Maria, Maria': 'int', 'Me Neither': 'int', 'Meanwhile Back At The Ranch': 'int', 'Meet Virginia': 'int', 'Mirror Mirror': 'int', 'Monica': 'int', 'More': 'int', 'Most Girls': 'int', 'Mr. Too Damn Good': 'int', 'Music': 'int', 'My Baby You': 'int', 'My Best Friend': 'int', 'My First Love': 'int', 'My Love Goes On And On': 'int', 'My Love Is Your Love': 'int', 'My Next Thirty Years': 'int', 'N 2 Gether Now': 'int', 'Never Let You Go': 'int', 'No Leaf Clover (Live)': 'int', 'No Matter What They Say': 'int', 'No Me Dejes De Querer': 'int', 'No Mercy': 'int', 'No More': 'int', 'No More Rain (In This Cloud)': 'int', 'None Of Ur Friends Business': 'int', 'Nothing As It Seems': 'int', 'One Night Stand': 'int', 'One Voice': 'int', 'Only God Knows Why': 'int', 'Oops!.. I Did It Again': 'int', 'Open My Heart': 'int', 'Original Prankster': 'int', 'Otherside': 'int', 'Party Up (Up In Here)': 'int', 'Pinch Me': 'int', 'Pop A Top': 'int', 'Pop Ya Collar': 'int', "Prayin' For Daylight": 'int', 'Private Emotion': 'int', 'Pull Over': 'int', 'Put Your Hand In Mine': 'int', 'Re-Arranged': 'int', 'Real Live Woman': 'int', 'Rhythm Divine': 'int', 'Riddle': 'int', "Rollin'": 'int', 'Ryde or Die, Chick': 'int', 'Same Script, Different Cast': 'int', 'Say My Name': 'int', 'Separated': 'int', 'Sexual (Li Da Di)': 'int', 'Shackles (Praise You)': 'int', 'Shake Ya Ass': 'int', 'Shake Your Bon-Bon': 'int', 'Shape Of My Heart': 'int', 'She Bangs': 'int', "She's More": 'int', 'Show Me The Meaning Of Being Lonely': 'int', 'Shut Up': 'int', 'Simple Kind Of Life': 'int', 'Sleepwalker': 'int', 'Smile': 'int', 'Smoke Rings In The Dark': 'int', 'Some Things Never Change': 'int', 'Someday Out Of The Blue': 'int', 'Souljas': 'int', 'Sour Girl': 'int', 'Spanish Guitar': 'int', 'Stan': 'int', 'Stay Or Let It Go': 'int', 'Stay The Night': 'int', 'Still In My Heart': 'int', 'Straight Up': 'int', 'Summer Rain': 'int', 'Swear It Again': 'int', 'Ta Da': 'int', 'Take A Picture': 'int', 'Take That': 'int', 'Taking You Home': 'int', 'Tha Block Is Hot': 'int', 'Thank God I Found You': 'int', 'That Other Woman': 'int', "That's The Kind Of Mood I'm In": 'int', "That's The Way": 'int', "That's The Way It Is": 'int', "That's What I'm Looking For": 'int', 'The Bad Touch': 'int', 'The Best Day': 'int', 'The Best Man I Can Be': 'int', 'The Best Of Me': 'int', 'The Chain Of Love': 'int', 'The Great Beyond': 'int', 'The Hardest Part Of Breaking Up (Is Getting Back Your Stuff)': 'int', 'The Itch': 'int', 'The Light': 'int', 'The Little Girl': 'int', 'The Next Episode': 'int', 'The One': 'int', "The Quittin' Kind": 'int', 'The Real Slim Shady': 'int', 'The Rockafeller Skank': 'int', 'The Way I Am': 'int', 'Then The Morning Comes': 'int', 'There U Go': 'int', 'There You Are': 'int', 'This I Promise You': 'int', 'This Time Around': 'int', 'This Woman Needs': 'int', 'Thong Song': 'int', "Toca's Miracle": 'int', 'Treat Her Like A Lady': 'int', 'Tricky Tricky ': 'int', 'Try Again': 'int', "U Don't Love Me": 'int', 'U Understand': 'int', 'Unconditional': 'int', 'Untitled (How Does It Feel)': 'int', 'We Danced': 'int', 'West Side Story': 'int', 'What A Girl Wants': 'int', 'What About Now': 'int', 'What Do You Say': 'int', 'What I Need To Do': 'int', 'What Means The World To You': 'int', 'What You Want': 'int', "What'Chu Like": 'int', "What's My Name": 'int', "What's Your Fantasy": 'int', 'Whatever': 'int', 'When You Need My Love': 'int', 'Where I Wanna Be': 'int', 'Where You Are': 'int', 'Whistle While You Twurk': 'int', 'Who Let The Dogs Out': 'int', 'Whoa!': 'int', 'Wifey': 'int', 'With Arms Wide Open': 'int', 'Without You': 'int', 'Wobble Wobble': 'int', 'Wonderful': 'int', 'Yes!': 'int', 'You Can Do It': 'int', 'You Owe Me': 'int', 'You Sang To Me': 'int', "You Should've Told Me": 'int', "You Won't Be Lonely Now": 'int', "You'll Always Be Loved By Me": 'int', "You're A God": 'int', 'Your Everything': 'int', 'www.memory': 'int'})
billboard_melted_df7 = DropColumns(billboard_melted_df6, non_top_tracks)
